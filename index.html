<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HELLO FRIEND :]</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
            font-family: 'Orbitron', sans-serif;
        }

        #gameCanvas {
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
        }

        #overlay {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            font-size: 14px;
            color: #666;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.3;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.3;
            }
        }
    </style>
</head>

<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <!-- <div id="overlay">PRESS ANY KEY TO START GAME</div> -->

    <style>
        #pre-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            color: #0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            z-index: 1000;
            cursor: pointer;
            text-shadow: 0 0 10px #0f0;
        }

        }
    </style>
    <div id="pre-overlay">[ PRESS ANY KEY TO INITIALIZE ]</div>

    <!-- Cracktro Loader Harness -->
    <script>
        // MOCK LOGIC GLOBALS Required by credits.js
        window.gameCanvas = document.getElementById('gameCanvas');
        window.gameCtx = window.gameCanvas.getContext('2d');
        window.gameStates = { CREDITS: 5 };
        window.setGameState = (s) => { }; // No-op
        window.gameKeys = {}; // Minimal Input Tracking
        window.gameAudio = new (window.AudioContext || window.webkitAudioContext)();

        // Redirect Logic
        window.goToWelcome = function () {
            window.location.href = 'game.html?autostart=true';
        };

        // Resume Audio on interaction
        function unlockAudio() {
            // 1. Web Audio API Context
            if (window.gameAudio && window.gameAudio.state === 'suspended') {
                window.gameAudio.resume();
            }
            // 2. HTML5 Music Track (If blocked)
            if (window.cracktroAudio && window.cracktroAudio.paused) {
                // Only play if we have actually started the music phase (volume > 0 or intended)
                // Just calling play() is safe, the logic in cracktro.js manages volume fade-in.
                // However, directly playing might jump to full volume if we aren't careful?
                // Actually cracktro.js sets volume to 0.6 initially, then 0 for fade in.
                // If we are late, volume might be 0.6.
                window.cracktroAudio.play().catch(e => { });
            }
        }

        // Input Handling
        window.addEventListener('keydown', (e) => {
            unlockAudio();
            // Trigger Exit Sequence if Logo finished
            if (window.cracktroLogoComplete && !window.cracktroExitComplete) {
                window.triggerCracktroExit();
            }
        });
        window.addEventListener('click', () => {
            unlockAudio();
            if (window.cracktroLogoComplete && !window.cracktroExitComplete) {
                window.triggerCracktroExit();
            }
        });

        // Loop
        function loop() {
            if (window.updateCredits) window.updateCredits();

            // Check for exit completion
            if (window.cracktroExitComplete) {
                window.goToWelcome();
                return; // Stop loop
            }

            // Clear Screen
            window.gameCtx.fillStyle = "black";
            window.gameCtx.fillRect(0, 0, window.gameCanvas.width, window.gameCanvas.height);

            if (window.drawCredits) window.drawCredits();

            // Show Overlay only when ready - REMOVED BY REQUEST
            // const ov = document.getElementById('overlay');
            // if (ov) ov.display = 'none';

            requestAnimationFrame(loop);
        }

        // Start
        // Start Logic
        let hasStarted = false;

        function startExperience() {
            if (hasStarted) return;
            hasStarted = true;

            // Hide Pre-Overlay
            const preOv = document.getElementById('pre-overlay');
            if (preOv) preOv.style.display = 'none';

            // Resume/Start Audio Context
            if (window.gameAudio) {
                window.gameAudio.resume().then(() => {
                    console.log("Audio Context Resumed");
                }).catch(e => console.error(e));
            }
            // 2. HTML5 Music Track (Try to start if context failed or as backup)
            if (window.cracktroAudio) {
                window.cracktroAudio.play().catch(e => { });
            }

            // Start Cracktro
            if (window.showCredits) window.showCredits();
            loop();
        }

        window.onload = function () {
            // Show "Click to Start" if not auto-started
            const preOv = document.getElementById('pre-overlay');
            if (preOv) preOv.style.display = 'flex';

            // Listen for start
            window.addEventListener('keydown', startExperience);
            window.addEventListener('click', startExperience);
        };
    </script>

    <!-- Load Cracktro Logic -->
    <script src="assets/js/cracktro.js?v=67"></script>
</body>

</html>